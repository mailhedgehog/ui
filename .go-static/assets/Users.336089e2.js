import{o,c as r,a as e,d as ae,b as oe,i as ne,L as le,u as re,l as g,E as ie,m as de,p as ce,t as i,k as t,n as B,q as C,s as m,v as x,x as P,F as v,j as y,f as D,w as $,M as q,g as ue,H as pe}from"./index.7c1e58c1.js";import{P as R,r as _e}from"./pagination.d760d784.js";import{r as z}from"./TrashIcon.a110078a.js";import{_ as me,h as X,Y as xe,z as he,S as ve}from"./transition.c8b00211.js";import"./keyboard.fb260a87.js";function H(F,a){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function fe(F,a){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function we(F,a){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"})])}const be={class:"lg:-mt-px bg-context-50 dark:bg-context-900 shadow dark:shadow-context-500"},ke={class:"px-4 sm:px-6 lg:mx-auto lg:max-w-6xl lg:px-8"},ye={class:"py-6 flex items-center justify-between"},ge={class:"ml-3 text-xl md:text-2xl font-bold leading-7 text-context-900 dark:text-context-100 truncate sm:leading-9"},Ce={class:"hidden md:inline"},je={class:"mt-8"},Pe={key:0,class:""},$e={class:"ml-3 text-lg md:text-xl text-center text-context-900 dark:text-context-100 select-none"},Te={role:"list",class:"mt-2 divide-y divide-context-200 overflow-hidden shadow dark:shadow-context-500"},Ue={class:"block bg-context-50 dark:bg-context-800 px-4 py-4 hover:bg-context-50"},Me={class:"flex items-center space-x-4"},Ve={class:"flex flex-1 space-x-2 truncate"},qe={class:"flex flex-col truncate text-sm text-context-500 dark:text-context-400"},Ee={key:0,class:"truncate"},Le={class:"font-medium text-context-900 dark:text-context-100 mr-2"},Be={class:"space-y-2"},Fe=["onClick"],Se=["onClick"],De={class:"flex items-center justify-between border-t border-context-200 bg-context-50 dark:bg-context-800 px-4 py-3","aria-label":"Pagination"},Re={class:"flex flex-1 justify-between"},ze=["disabled"],Ne=["disabled"],Oe={key:1,class:"hidden md:block"},Ie={class:"mt-2 flex flex-col"},Ze={class:"min-w-full overflow-hidden overflow-x-auto align-middle shadow md:rounded-lg"},Ye={class:"min-w-full divide-y divide-context-200"},Ae={class:"bg-context-50 dark:bg-context-700 px-6 py-3 text-left text-sm font-semibold text-context-900 dark:text-context-100",scope:"col"},Ge={class:"bg-context-50 dark:bg-context-700 px-6 py-3 text-sm font-semibold text-context-900 dark:text-context-100 text-right",scope:"col"},Je={class:"divide-y divide-context-200 bg-context-50 dark:bg-context-800"},Ke={class:"max-w-[12rem] whitespace-nowrap px-6 py-4 text-sm text-context-900 dark:text-context-100"},Qe={class:"truncate"},We={class:"whitespace-nowrap px-6 py-4 text-sm text-right flex justify-end space-x-1"},Xe=["onClick"],He=["onClick"],et={class:"flex items-center justify-between border-t border-context-200 bg-context-50 dark:bg-context-800 px-4 py-3 sm:px-6","aria-label":"Pagination"},tt={class:"hidden sm:block"},st=["innerHTML"],at={class:"flex flex-1 justify-between sm:justify-end"},ot=["disabled"],nt=["disabled"],lt=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),rt={class:"fixed inset-0 z-10 overflow-y-auto"},it={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},dt={class:"text-center sm:mt-5"},ct={class:"block mt-6 text-left text-context-900 dark:text-context-100"},ut={class:"space-y-6"},pt={key:0},_t={for:"new_username",class:"form-label"},mt={class:"mt-1 flex"},xt=["required","placeholder"],ht={for:"hub_password",class:"form-label"},vt={class:"mt-1 flex"},ft=["required","placeholder"],wt={class:"form-hint"},bt={for:"smtp_password",class:"form-label"},kt={class:"mt-1 flex"},yt=["placeholder"],gt={class:"form-hint"},Ct={class:"flex justify-between"},jt={for:"smtp_auth_ips",class:"form-label"},Pt={class:"mt-1 flex flex-col -space-y-px"},$t=["id","onUpdate:modelValue","placeholder"],Tt=["onClick"],Ut={class:"mt-6 sm:mt-8 flex items-center justify-between"},Mt={type:"submit",class:"btn btn--primary"},Vt={for:"search-field",class:"sr-only"},qt={class:"relative w-full text-context-400 focus-within:text-context-600"},Et={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center","aria-hidden":"true"},Lt=["placeholder"],zt=ae({__name:"Users",setup(F){const{t:a}=oe(),d=ne("MailHedgehog");le();const ee=re(),T=g({page:1,per_page:25,search:""}),N=g(!1),w=g(!1),E=g([]),u=g(new R),j=(c=null)=>{w.value=!0,c&&(T.value.page=c),d==null||d.request().get("users",{params:T.value}).then(s=>{var b,l,f,M,V,h,_,k,Z,Y,A,G,J,K,Q,W;(b=s.data)!=null&&b.data?E.value=(l=s.data)==null?void 0:l.data:E.value=[],(M=(f=s.data)==null?void 0:f.meta)!=null&&M.pagination?u.value=new R((h=(V=s.data)==null?void 0:V.meta)==null?void 0:h.pagination.current_page,(k=(_=s.data)==null?void 0:_.meta)==null?void 0:k.pagination.per_page,(Y=(Z=s.data)==null?void 0:Z.meta)==null?void 0:Y.pagination.last_page,(G=(A=s.data)==null?void 0:A.meta)==null?void 0:G.pagination.from,(K=(J=s.data)==null?void 0:J.meta)==null?void 0:K.pagination.to,(W=(Q=s.data)==null?void 0:Q.meta)==null?void 0:W.pagination.total):u.value=new R}).finally(()=>{w.value=!1})};let L=null;ie(()=>T.value.search,()=>{L&&(clearTimeout(L),L=null),L=setTimeout(()=>{j(1)},500)},{deep:!0}),de(()=>{j(1),N.value=!0});const U=(c="next")=>{j(u.value.getPageFromDirection(c))},p=g(null),n=g({new_username:null,dashboard_password:null,smtp_password:null,smtp_auth_ips:[],smtp_allow_listed_ips:[],dashboard_auth_emails:[]}),O=c=>{n.value.smtp_auth_ips=c.smtp_auth_ips,n.value.smtp_allow_listed_ips=c.smtp_allow_listed_ips,n.value.dashboard_auth_emails=c.dashboard_auth_emails,p.value=c},te=()=>{p.value={username:"",smtp_auth_ips:[],smtp_allow_listed_ips:[],dashboard_auth_emails:[]}},se=()=>{var b;w.value=!0;const c=d==null?void 0:d.request();let s;(b=p.value)!=null&&b.username?s=c==null?void 0:c.put(`users/${p.value.username}`,{dashboard_password:n.value.dashboard_password,smtp_password:n.value.smtp_password,smtp_auth_ips:n.value.smtp_auth_ips,smtp_allow_listed_ips:n.value.smtp_allow_listed_ips,dashboard_auth_emails:n.value.dashboard_auth_emails}):s=c==null?void 0:c.post("users",{username:n.value.new_username,dashboard_password:n.value.dashboard_password,smtp_password:n.value.smtp_password,smtp_auth_ips:n.value.smtp_auth_ips,smtp_allow_listed_ips:n.value.smtp_allow_listed_ips,dashboard_auth_emails:n.value.dashboard_auth_emails}),s==null||s.then(l=>{var f;j(),(f=p.value)!=null&&f.username?d==null||d.success(a("users.updated")):d==null||d.success(a("users.created")),S()}).catch(l=>{d==null||d.onResponseError(l,"Response Error")}).finally(()=>{w.value=!1})},S=()=>{p.value=null,n.value={new_username:null,dashboard_password:null,smtp_password:null,smtp_auth_ips:[],smtp_allow_listed_ips:[],dashboard_auth_emails:[]}},I=c=>{ee.dispatch("confirmDialog/confirm").then(()=>{w.value=!0,d==null||d.request().delete(`users/${c.username}`).then(()=>{u.value.count()===0?U("prev"):j(),d==null||d.success(a("users.deleted"))}).catch(s=>{d.onResponseError(s,"Response Error")}).catch(()=>{w.value=!1})})};return(c,s)=>{const b=ce("tooltip");return o(),r(v,null,[e("div",be,[e("div",ke,[e("div",ye,[e("h1",ge,i(t(a)("users.pageTitle")),1),e("div",{class:B(["flex justify-end ml-4 transition-all duration-200",{"pointer-events-none opacity-75":w.value}])},[u.value&&!u.value.isEmpty()?C((o(),r("button",{key:0,type:"button",class:"btn btn--default whitespace-nowrap",onClick:m(te,["prevent"])},[x(t(we),{class:"w-4 h-4 md:mr-2"}),e("span",Ce,i(t(a)("users.create")),1)])),[[b,t(a)("users.create")]]):P("",!0)],2)])])]),e("div",je,[u.value.isEmpty()?(o(),r("div",Pe,[e("h3",$e,[w.value?(o(),r(v,{key:0},[y(i(t(a)("pagination.requesting")),1)],64)):(o(),r(v,{key:1},[y(i(t(a)("users.empty")),1)],64))])])):(o(),r(v,{key:1},[u.value?(o(),r("div",{key:0,class:B(["shadow dark:shadow-context-500 md:hidden",{"pointer-events-none opacity-75":w.value}])},[e("ul",Te,[(o(!0),r(v,null,D(E.value,l=>(o(),r("li",{key:l.username},[e("div",Ue,[e("span",Me,[e("span",Ve,[e("span",qe,[l.username?(o(),r("span",Ee,[e("span",Le,i(t(a)("users.username")),1),y(" "+i(l.username),1)])):P("",!0)])]),e("div",Be,[e("a",{class:"cursor-pointer block transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>O(l),["prevent"])},[x(t(H),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})],8,Fe),e("a",{class:"cursor-pointer block transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>I(l),["prevent"])},[x(t(z),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})],8,Se)])])])]))),128))]),e("nav",De,[e("div",Re,[e("button",{disabled:u.value.isOnFirst(),class:"btn btn--default",onClick:s[0]||(s[0]=m(l=>U("prev"),["prevent"]))},i(t(a)("pagination.prev")),9,ze),e("button",{disabled:u.value.isOnLast(),class:"ml-3 btn btn--default",onClick:s[1]||(s[1]=m(l=>U("next"),["prevent"]))},i(t(a)("pagination.next")),9,Ne)])])],2)):P("",!0),u.value?(o(),r("div",Oe,[e("div",{class:B(["mx-auto max-w-6xl px-4 md:px-6 lg:px-8 transition-all duration-200",{"pointer-events-none opacity-75":w.value}])},[e("div",Ie,[e("div",Ze,[e("table",Ye,[e("thead",null,[e("tr",null,[e("th",Ae,i(t(a)("users.username")),1),e("th",Ge,i(t(a)("pagination.actions")),1)])]),e("tbody",Je,[(o(!0),r(v,null,D(E.value,l=>(o(),r("tr",{key:l.username,class:"bg-context-50 dark:bg-context-800"},[e("td",Ke,[e("div",Qe,i(l.username),1)]),e("td",We,[e("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>O(l),["prevent"])},[x(t(H),{class:"w-5 h-5","aria-hidden":"true"})],8,Xe),e("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300",onClick:m(f=>I(l),["prevent"])},[x(t(z),{class:"w-5 h-5","aria-hidden":"true"})],8,He)])]))),128))])]),e("nav",et,[e("div",tt,[e("p",{class:"text-sm text-context-700 dark:text-context-200",innerHTML:t(a)("pagination.text",{from:u.value.getFrom(),to:u.value.getTo(),of:u.value.getTotal()})},null,8,st)]),e("div",at,[e("button",{disabled:u.value.isOnFirst(),class:"btn btn--default",onClick:s[2]||(s[2]=m(l=>U("prev"),["prevent"]))},i(t(a)("pagination.prev")),9,ot),e("button",{disabled:u.value.isOnLast(),class:"ml-3 btn btn--default",onClick:s[3]||(s[3]=m(l=>U("next"),["prevent"]))},i(t(a)("pagination.next")),9,nt)])])])])],2)])):P("",!0)],64))]),x(t(ve),{as:"template",show:p.value!==null},{default:$(()=>[x(t(me),{as:"div",class:B(["relative z-10",{"pointer-events-none":w.value}]),onClose:S},{default:$(()=>[x(t(X),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:$(()=>[lt]),_:1}),e("div",rt,[e("div",it,[x(t(X),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:$(()=>[x(t(xe),{class:"bg-context-50 dark:bg-context-900 relative transform overflow-hidden rounded-lg px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},{default:$(()=>{var l,f,M,V;return[e("form",{onSubmit:m(se,["prevent"])},[e("div",null,[e("div",dt,[x(t(he),{as:"h3",class:"text-lg font-medium leading-6 text-context-900 dark:text-context-100"},{default:$(()=>{var h,_;return[((h=p.value)==null?void 0:h.username)===""?(o(),r(v,{key:0},[y(i(t(a)("users.modal.createTitle")),1)],64)):(o(),r(v,{key:1},[y(i(t(a)("users.modal.editTitle",{user:(_=p.value)==null?void 0:_.username})),1)],64))]}),_:1}),e("div",ct,[e("div",ut,[((l=p.value)==null?void 0:l.username)===""?(o(),r("div",pt,[e("label",_t,i(t(a)("users.username")),1),e("div",mt,[C(e("input",{id:"new_username","onUpdate:modelValue":s[4]||(s[4]=h=>n.value.new_username=h),name:"new_username",type:"text",autocomplete:"off",required:p.value.username==="",class:"form-input",placeholder:t(a)("users.username")},null,8,xt),[[q,n.value.new_username]])])])):P("",!0),e("div",null,[e("label",ht,i(t(a)("users.hubPassword")),1),e("div",vt,[C(e("input",{id:"hub_password","onUpdate:modelValue":s[5]||(s[5]=h=>n.value.dashboard_password=h),name:"hub_password",type:"password",autocomplete:"hub_password",required:((f=p.value)==null?void 0:f.username)==="",class:"form-input",placeholder:t(a)("users.hubPassword")},null,8,ft),[[q,n.value.dashboard_password]])]),e("div",wt,[((M=p.value)==null?void 0:M.username)===""?(o(),r(v,{key:0},[],64)):(o(),r(v,{key:1},[y(i(t(a)("users.emptyPasswordHint")),1)],64))])]),e("div",null,[e("label",bt,i(t(a)("users.smtpPassword")),1),e("div",kt,[C(e("input",{id:"smtp_password","onUpdate:modelValue":s[6]||(s[6]=h=>n.value.smtp_password=h),name:"smtp_password",type:"password",autocomplete:"smtp_password",class:"form-input",placeholder:t(a)("users.smtpPassword")},null,8,yt),[[q,n.value.smtp_password]])]),e("div",gt,[((V=p.value)==null?void 0:V.username)===""?(o(),r(v,{key:0},[y(i(t(a)("users.emptySmtpPasswordHint")),1)],64)):(o(),r(v,{key:1},[y(i(t(a)("users.emptyPasswordHint")),1)],64))])]),e("div",null,[e("div",Ct,[e("label",jt,i(t(a)("users.smtpNoPassIps")),1),C((o(),r("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-primary-500 hover:dark:text-primary-500 flex justify-center items-center w-auto px-3",onClick:s[7]||(s[7]=m(h=>{var _,k;return(k=(_=n.value)==null?void 0:_.smtp_auth_ips)==null?void 0:k.push("127.0.0.1")},["prevent"]))},[x(t(fe),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})])),[[b,t(a)("users.addIPHint")]])]),e("div",Pt,[(o(!0),r(v,null,D(n.value.smtp_auth_ips,(h,_)=>(o(),r("div",{key:_,class:"flex form-inputs-list-item"},[C(e("input",{id:`smtp_auth_ips_${_}`,"onUpdate:modelValue":k=>n.value.smtp_auth_ips[_]=k,name:"smtp_auth_ips[]",type:"text",autocomplete:"off",class:"form-input",placeholder:t(a)("users.ipPlaceholder"),maxlength:"39",required:""},null,8,$t),[[q,n.value.smtp_auth_ips[_]]]),e("a",{class:"cursor-pointer transition-all duration-500 text-context-500 dark:text-context-400 hover:text-context-700 hover:dark:text-context-300 flex justify-center items-center form-input w-auto border-l-0",onClick:m(k=>n.value.smtp_auth_ips.splice(_,1),["prevent"])},[x(t(z),{class:"h-5 w-5 flex-shrink-0","aria-hidden":"true"})],8,Tt)]))),128))])])])])])]),e("div",Ut,[e("button",{type:"button",class:"btn btn--default",onClick:m(S,["prevent"])},i(t(a)("users.modal.cancel")),1),e("button",Mt,i(t(a)("users.modal.submit")),1)])],32)]}),_:1})]),_:1})])])]),_:1},8,["class"])]),_:1},8,["show"]),N.value?(o(),ue(pe,{key:0,to:"#header-search"},[e("form",{class:"flex w-full md:ml-0",method:"GET",onSubmit:s[9]||(s[9]=m(l=>j(1),["prevent"]))},[e("label",Vt,i(t(a)("inbox.search")),1),e("div",qt,[e("div",Et,[x(t(_e),{class:"h-5 w-5","aria-hidden":"true"})]),C(e("input",{id:"search-field","onUpdate:modelValue":s[8]||(s[8]=l=>T.value.search=l),name:"search-field",class:"block h-full w-full py-2 pl-8 pr-3 sm:text-sm focus:outline-none focus:ring-0 border-transparent focus:border-transparent placeholder-context-500 bg-context-50 dark:bg-context-900 text-context-900 dark:text-context-100",placeholder:t(a)("users.search"),type:"search"},null,8,Lt),[[q,T.value.search]])])],32)])):P("",!0)],64)}}});export{zt as default};
